# ============================================================
# colormaps.py — 스펙트로그램용 컬러맵 LUT
# ============================================================
"""
matplotlib 없이 256-entry RGB 컬러맵을 제공합니다.
Magma, Inferno: 하드코딩 LUT
Viridis, Turbo, Grayscale: 런타임 보간 생성
"""

try:
    import numpy as np
    HAS_NUMPY = True
except ImportError:
    HAS_NUMPY = False


# ── 하드코딩 LUT (Magma) ──
_MAGMA_COLORS = [
    (0,0,3),(0,0,4),(0,0,6),(1,0,7),(1,1,9),(1,1,11),(2,2,13),(2,2,15),
    (3,3,17),(4,3,19),(4,4,21),(5,4,23),(6,5,25),(7,5,27),(8,6,29),(9,7,31),
    (10,7,34),(11,8,36),(12,9,38),(13,10,40),(14,10,42),(15,11,44),(16,12,47),(17,12,49),
    (18,13,51),(20,13,53),(21,14,56),(22,14,58),(23,15,60),(24,15,63),(26,16,65),(27,16,68),
    (28,16,70),(30,16,73),(31,17,75),(32,17,77),(34,17,80),(35,17,82),(37,17,85),(38,17,87),
    (40,17,89),(42,17,92),(43,17,94),(45,16,96),(47,16,98),(48,16,101),(50,16,103),(52,16,104),
    (53,15,106),(55,15,108),(57,15,110),(59,15,111),(60,15,113),(62,15,114),(64,15,115),(66,15,116),
    (67,15,117),(69,15,118),(71,15,119),(72,16,120),(74,16,121),(75,16,121),(77,17,122),(79,17,123),
    (80,18,123),(82,18,124),(83,19,124),(85,19,125),(87,20,125),(88,21,126),(90,21,126),(91,22,126),
    (93,23,126),(94,23,127),(96,24,127),(97,24,127),(99,25,127),(101,26,128),(102,26,128),(104,27,128),
    (105,28,128),(107,28,128),(108,29,128),(110,30,129),(111,30,129),(113,31,129),(115,31,129),(116,32,129),
    (118,33,129),(119,33,129),(121,34,129),(122,34,129),(124,35,129),(126,36,129),(127,36,129),(129,37,129),
    (130,37,129),(132,38,129),(133,38,129),(135,39,129),(137,40,129),(138,40,129),(140,41,128),(141,41,128),
    (143,42,128),(145,42,128),(146,43,128),(148,43,128),(149,44,128),(151,44,127),(153,45,127),(154,45,127),
    (156,46,127),(158,46,126),(159,47,126),(161,47,126),(163,48,126),(164,48,125),(166,49,125),(167,49,125),
    (169,50,124),(171,51,124),(172,51,123),(174,52,123),(176,52,123),(177,53,122),(179,53,122),(181,54,121),
    (182,54,121),(184,55,120),(185,55,120),(187,56,119),(189,57,119),(190,57,118),(192,58,117),(194,58,117),
    (195,59,116),(197,60,116),(198,60,115),(200,61,114),(202,62,114),(203,62,113),(205,63,112),(206,64,112),
    (208,65,111),(209,66,110),(211,66,109),(212,67,109),(214,68,108),(215,69,107),(217,70,106),(218,71,105),
    (220,72,105),(221,73,104),(222,74,103),(224,75,102),(225,76,102),(226,77,101),(228,78,100),(229,80,99),
    (230,81,98),(231,82,98),(232,84,97),(234,85,96),(235,86,96),(236,88,95),(237,89,95),(238,91,94),
    (238,93,93),(239,94,93),(240,96,93),(241,97,92),(242,99,92),(243,101,92),(243,103,91),(244,104,91),
    (245,106,91),(245,108,91),(246,110,91),(246,112,91),(247,113,91),(247,115,92),(248,117,92),(248,119,92),
    (249,121,92),(249,123,93),(249,125,93),(250,127,94),(250,128,94),(250,130,95),(251,132,96),(251,134,96),
    (251,136,97),(251,138,98),(252,140,99),(252,142,99),(252,144,100),(252,146,101),(252,147,102),(253,149,103),
    (253,151,104),(253,153,105),(253,155,106),(253,157,107),(253,159,108),(253,161,110),(253,162,111),(253,164,112),
    (254,166,113),(254,168,115),(254,170,116),(254,172,117),(254,174,118),(254,175,120),(254,177,121),(254,179,123),
    (254,181,124),(254,183,125),(254,185,127),(254,187,128),(254,188,130),(254,190,131),(254,192,133),(254,194,134),
    (254,196,136),(254,198,137),(254,199,139),(254,201,141),(254,203,142),(253,205,144),(253,207,146),(253,209,147),
    (253,210,149),(253,212,151),(253,214,152),(253,216,154),(253,218,156),(253,220,157),(253,221,159),(253,223,161),
    (253,225,163),(252,227,165),(252,229,166),(252,230,168),(252,232,170),(252,234,172),(252,236,174),(252,238,176),
    (252,240,177),(252,241,179),(252,243,181),(252,245,183),(251,247,185),(251,249,187),(251,250,189),(251,252,191),
]

# ── 하드코딩 LUT (Inferno) ──
_INFERNO_COLORS = [
    (0,0,3),(0,0,4),(0,0,6),(1,0,7),(1,1,9),(1,1,11),(2,1,14),(2,2,16),
    (3,2,18),(4,3,20),(4,3,22),(5,4,24),(6,4,26),(7,5,28),(8,6,30),(9,7,32),
    (10,7,35),(11,8,37),(12,9,39),(13,9,41),(14,10,44),(15,11,46),(16,11,49),(17,12,51),
    (18,12,54),(20,12,56),(21,13,59),(22,13,61),(24,13,64),(25,13,66),(27,13,68),(28,13,71),
    (30,13,73),(31,13,75),(33,13,77),(35,13,79),(36,13,81),(38,13,83),(40,12,85),(41,12,87),
    (43,12,88),(45,12,90),(47,11,91),(49,11,92),(51,11,93),(52,10,94),(54,10,95),(56,10,95),
    (58,10,96),(60,10,96),(62,10,97),(63,10,97),(65,10,97),(67,10,97),(69,10,97),(71,11,97),
    (73,11,97),(74,12,97),(76,12,97),(78,13,96),(80,13,96),(81,14,96),(83,15,95),(85,15,95),
    (87,16,94),(88,17,94),(90,18,93),(92,18,93),(93,19,92),(95,20,91),(97,21,91),(98,22,90),
    (100,23,89),(102,24,88),(103,25,87),(105,26,87),(107,27,86),(108,28,85),(110,29,84),(112,30,83),
    (113,31,82),(115,32,81),(117,33,80),(118,34,79),(120,36,78),(122,37,77),(123,38,76),(125,39,75),
    (126,40,74),(128,42,72),(130,43,71),(131,44,70),(133,46,69),(134,47,68),(136,48,67),(138,50,66),
    (139,51,65),(141,53,63),(142,54,62),(144,56,61),(146,57,60),(147,59,59),(149,60,58),(150,62,56),
    (152,63,55),(153,65,54),(155,67,53),(156,68,52),(158,70,51),(159,72,49),(161,73,48),(162,75,47),
    (164,77,46),(165,79,45),(167,80,44),(168,82,43),(170,84,42),(171,86,41),(172,88,40),(174,90,39),
    (175,91,38),(177,93,38),(178,95,37),(179,97,36),(181,99,36),(182,101,35),(183,103,35),(185,105,35),
    (186,107,35),(187,109,35),(188,111,35),(189,113,35),(190,115,36),(191,117,36),(192,119,37),(193,121,38),
    (194,123,38),(195,125,39),(196,127,40),(197,129,41),(198,131,42),(198,133,44),(199,135,45),(200,137,46),
    (200,139,48),(201,141,49),(201,143,51),(202,145,53),(202,147,54),(203,149,56),(203,151,58),(204,153,60),
    (204,155,62),(204,157,64),(205,159,66),(205,161,68),(205,163,70),(205,165,72),(206,167,74),(206,169,76),
    (206,171,78),(206,173,81),(206,175,83),(206,177,85),(206,179,88),(206,181,90),(206,183,92),(205,185,95),
    (205,187,97),(205,189,99),(205,191,102),(205,193,104),(204,195,107),(204,197,109),(204,199,112),(203,201,114),
    (203,203,117),(203,205,119),(202,207,122),(202,209,124),(202,211,127),(201,213,129),(201,215,132),(201,217,134),
    (201,219,137),(201,221,139),(201,223,142),(201,224,144),(202,226,146),(202,228,149),(203,230,151),(203,232,153),
    (204,233,155),(205,235,158),(206,237,160),(208,238,162),(209,240,164),(211,241,166),(213,243,167),(214,244,169),
    (216,245,171),(218,246,173),(220,248,174),(222,249,176),(224,250,177),(226,251,178),(229,252,179),(231,253,181),
    (233,253,182),(236,254,183),(238,255,184),(240,255,185),(243,255,186),(245,255,187),(247,255,188),(250,255,189),
    (251,255,190),(252,255,191),(253,255,192),(254,255,193),(254,255,194),(255,255,195),(255,255,196),(255,255,197),
    (255,255,198),(255,255,199),(255,255,201),(255,255,202),(255,255,203),(255,255,205),(255,255,206),(255,255,208),
    (255,255,209),(255,255,211),(255,255,212),(255,255,214),(255,255,215),(255,255,217),(255,255,219),(255,255,220),
    (252,255,222),(250,255,224),(248,255,225),(246,255,227),(244,255,229),(243,255,231),(241,255,233),(240,255,235),
    (239,255,237),(238,255,239),(237,255,241),(236,255,243),(235,255,245),(235,255,247),(234,255,249),(234,255,251),
]


def _generate_grayscale_lut():
    """그레이스케일 LUT 생성"""
    return np.array([(i, i, i) for i in range(256)], dtype=np.uint8)


def _generate_viridis_lut():
    """Viridis 근사 LUT 생성 (주요 컨트롤 포인트 보간)"""
    pts = [
        (0, 68, 1, 84), (32, 71, 44, 122), (64, 59, 82, 139),
        (96, 44, 114, 142), (128, 33, 145, 140), (160, 53, 183, 121),
        (192, 109, 206, 89), (224, 180, 222, 44), (255, 253, 231, 37),
    ]
    lut = np.zeros((256, 3), dtype=np.uint8)
    for i in range(len(pts) - 1):
        p0, p1 = pts[i], pts[i + 1]
        for j in range(p0[0], p1[0] + 1):
            t = (j - p0[0]) / max(p1[0] - p0[0], 1)
            lut[j] = [
                int(p0[1] + t * (p1[1] - p0[1])),
                int(p0[2] + t * (p1[2] - p0[2])),
                int(p0[3] + t * (p1[3] - p0[3])),
            ]
    return lut


def _generate_turbo_lut():
    """Turbo 근사 LUT 생성 (레인보우 계열)"""
    pts = [
        (0, 48, 18, 59), (32, 35, 69, 180), (64, 18, 131, 244),
        (96, 34, 191, 196), (128, 80, 233, 145), (160, 167, 249, 79),
        (192, 231, 217, 48), (224, 249, 149, 33), (255, 122, 4, 3),
    ]
    lut = np.zeros((256, 3), dtype=np.uint8)
    for i in range(len(pts) - 1):
        p0, p1 = pts[i], pts[i + 1]
        for j in range(p0[0], p1[0] + 1):
            t = (j - p0[0]) / max(p1[0] - p0[0], 1)
            lut[j] = [
                int(p0[1] + t * (p1[1] - p0[1])),
                int(p0[2] + t * (p1[2] - p0[2])),
                int(p0[3] + t * (p1[3] - p0[3])),
            ]
    return lut


# ── 컬러맵 딕셔너리 구성 ──
if HAS_NUMPY:
    COLORMAPS = {
        "Magma":  np.array(_MAGMA_COLORS, dtype=np.uint8),
        "Inferno": np.array(_INFERNO_COLORS, dtype=np.uint8),
        "Viridis": _generate_viridis_lut(),
        "Grayscale": _generate_grayscale_lut(),
        "Turbo": _generate_turbo_lut(),
    }
    MAGMA_LUT = COLORMAPS["Magma"]  # 기본 호환
else:
    COLORMAPS = {}
    MAGMA_LUT = None


# 검출 오버레이용 종별 색상 팔레트
DETECTION_COLORS = [
    ("#FF6B6B", "#FF6B6B40"),  # 빨강
    ("#4ECDC4", "#4ECDC440"),  # 청록
    ("#FFE66D", "#FFE66D40"),  # 노랑
    ("#A8E6CF", "#A8E6CF40"),  # 연두
    ("#DDA0DD", "#DDA0DD40"),  # 보라
    ("#87CEEB", "#87CEEB40"),  # 하늘
    ("#FFA07A", "#FFA07A40"),  # 살몬
    ("#98FB98", "#98FB9840"),  # 연녹
]
